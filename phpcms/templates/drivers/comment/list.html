{template "content","header"}
{pc:comment action="get_comment" commentid="$commentid"}
{php $comment = $data;}
{/pc}
<div class="w100">
    <div class="main w1100" style="margin: 0 auto; padding-top: 10px;">
        <h2 class="comment-title blue"><a href="{if $comment[url]}{$comment[url]}{else}{$url}{/if}" style="font-size: 25px;">{if $comment[title]}{$comment[title]}{else}{$title}{/if}</a> <a href="#comment" class="f12 fn"><font color="#FF0000">[?????????]</font></a></h2>
        <div class="comment_button"><a href="{APP_PATH}index.php?m=comment&c=index&a=init&commentid={$commentid}&title={urlencode(($comment[title] ? $comment[title] : $title))}&url={urlencode(($comment[url] ? $comment[url] : $url))}&hot=0"{if empty($hot)} class="on"{/if}>????</a> <a href="{APP_PATH}index.php?m=comment&c=index&a=init&commentid={$commentid}&title={urlencode(($comment[title] ? $comment[title] : $title))}&url={urlencode(($comment[url] ? $comment[url] : $url))}&hot=1"{if $hot} class="on"{/if}>????</a></div>  

        <div class="w1100" style="height: auto;">
            <div class="fl">
                <div class="col-left" style="position: relative; margin-top: 15px; margin-left: 10px;">
                    <div class="comment">
                        <h4 class="f14">
                            ?????б?<span class="f12 fn">?????? <font color="red">{if $comment[total]}{$comment[total]}{else}0{/if}</font>??????????????????????????????????????</span>
                        </h4>
                        {pc:comment action="lists" commentid="$commentid" siteid="$siteid" page="$_GET[page]" hot="$hot" num="20"}
                        {loop $data $r}
                            <h5 class="title fn">{direction($r[direction])} 
                                <font color="#FF0000">{format::date($r[creat_at], 1)}</font> {if $r[userid]}{get_nickname($r[userid])}{else}{$r[username]}{/if} 
                            </h5>
                            <div class="content">{stripcslashes($r[content])}
                                <div class="rt">
                                    <a href="javascript:void(0)" onclick="reply({$r[id]}, '{$commentid}')">???</a> 
                                    <a href="javascript:void(0)" onclick="support({$r[id]}, '{$commentid}')">???</a>??<font id="support_{$r[id]}">{$r[support]}</font>??
                                </div>
                                <div id="reply_{$r[id]}" style="display:none"></div>
                            </div>
                            <div class="bk30 hr mb8"></div>
                        {/loop}
                        {/pc}
                    </div>
                    <div id="pages" class="text-r">{$pages}</div>
                    <div class="bk10"></div>

                    <div class="comment-form">
                        <form action="{APP_PATH}index.php?m=comment&c=index&a=post&commentid={$commentid}" method="post">
                            <input type="hidden" name="title" value="{urlencode(($comment[title] ? $comment[title] : $title))}">
                            <input type="hidden" name="url" value="{urlencode(($comment[url] ? $comment[url] : $url))}">
                            <a name="comment"></a>
                            <h5><strong>?????????</strong></h5>
                            <div class="posn">???????<input type="radio" name="direction" value="1" />
                                <img src="{IMG_PATH}icon/zheng.png" /> 
                                <input type="radio" name="direction" value="2" /> 
                                <img src="{IMG_PATH}icon/fan.png" /> 
                                <input type="radio" name="direction" value="3"  /> 
                                <img src="{IMG_PATH}icon/zhong.png" />
                            </div>
                            <textarea rows="8" cols="80" name="content"></textarea><br>
                            {if $setting[code]}
                                <label>
                                    ?????<input type="text" name="code"  class="input-text" id="yzmText" onfocus="var offset = $(this).offset();$('#yzm').css({'left': +offset.left-8, 'top': +offset.top-$('#yzm').height()});$('#yzm').show();$('#yzmText').data('hide', 1)" onblur='$("#yzmText").data("hide", 0);setTimeout("hide_code()", 3000)' />
                                </label>
                                <div id="yzm" class="yzm">{form::checkcode()}<br />?????????</a></div>
                                <div class="bk10"></div>
                            {/if}
                                <div class="btn"><input type="submit" style="margin-top:20px; background-color:#2975c4; font-size: 12px; border-radius: 3px; text-align: center; padding: 0 5px; " value="????????" />
                                </div>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{if $userid}{get_nickname()} <a href="{APP_PATH}index.php?m=member&c=index&a=logout&forward={urlencode(get_url())}">???</a>{else}<a href="{APP_PATH}index.php?m=member&c=index&a=login&forward={urlencode(get_url())}" class="blue">???</a><span> | </span><a href="{APP_PATH}index.php?m=member&c=index&a=register" class="blue">???</a>  {if !$setting[guest]}<span style="color:red">????????????????</span>{/if}{/if}
                        </form>
                        <style type="text/css">
                        .look-content{ padding:10px;border:1px dashed #ffbf7a; background:#fffced; margin:10px auto}
                        .look-content ul{ color:#666; overflow: hidden;}
                        </style>
                        <div class="look-content">
                            <h6>???????</h6>
                            <ul>
                                <li>??????????????????????ɡ???????????????</li>
                                <li>???????????????????????????????????????????????????л????????????????й???????</li>
                                <li>???????Σ?????????????????????????????????????????????衢????????????????????????</li>
                                <li>?е?????????????????????????????????·???????</li>
                                <li>???????????????????????????????????????????????????</li>
                                <li>???????????????????????????????????</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="fr">
                <div class="col-auto fr" style="margin-top: 15px; margin-right: 10px;">
                    <div class="box" style="position: relative; height: auto; width: 310px;">
                        <h5 class="title-2">????????</h5>
                        {pc:comment action="bang" cache="3600"}
                        <ul class="content list f12 lh22">
                    {loop $data $r}
                            <li class="clearfix">??<a href="{$r[url]}" title="{$r[title]}">{str_cut($r[title], 26)}</a>({$r[total]})</li>
                    {/loop}
                        </ul>
                        {/pc}
                    </div>
                    <div class="bk10"></div>
                </div>
            </div>
        </div>
    </div>
</div>


<div style="margin-top: 15px 0;">
    {template "content","footer2"}
</div>

<script type="text/javascript">
function support(id, commentid) {
	$.getJSON('{APP_PATH}index.php?m=comment&c=index&a=support&format=jsonp&commentid='+commentid+'&id='+id+'&callback=?', function(data){
		if(data.status == 1) {
			$('#support_'+id).html(parseInt($('#support_'+id).html())+1);
		} else {
			alert(data.msg);
		}
	});
}

function reply(id,commentid) {
	var str = '<form action="{APP_PATH}index.php?m=comment&c=index&a=post&commentid='+commentid+'&id='+id+'" method="post"><textarea rows="10" style="width:100%" name="content"></textarea>{if $setting[code]}<label>?????<input type="text" name="code"  class="input-text" onfocus="var offset = $(this).offset();$(\'#yzm\').css({\'left\': +offset.left-8, \'top\': +offset.top-$(\'#yzm\').height()});$(\'#yzm\').show();$(\'#yzmText\').data(\'hide\', 1)" onblur=\'$("#yzmText").data("hide", 0);setTimeout("hide_code()", 3000)\' /></label>{/if}  <div class="btn"><input type="submit" value="????????" /></div>&nbsp;&nbsp;&nbsp;&nbsp;{if $userid}{get_nickname()} <a href="{APP_PATH}index.php?m=member&c=index&a=logout&forward={urlencode(get_url())}">???</a>{else}<a href="{APP_PATH}index.php?m=member&c=index&a=login&forward={urlencode(get_url())}" class="blue">???</a> | <a href="{APP_PATH}index.php?m=member&c=index&a=register" class="blue">???</a>  {if !$setting[guest]}<span style="color:red">????????????????</span>{/if}{/if}</form>';
	$('#reply_'+id).html(str).toggle();
}

function hide_code() {
	if ($('#yzmText').data('hide')==0) {
		$('#yzm').hide();
	}
}
</script>
